!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Stomp=t():e.Stomp=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}e.d(t,{default:()=>h});var o=[].slice,s={}.hasOwnProperty,u="\n",a=function(){function e(t,i,r){n(this,e),this.command=t,this.headers=null!=i?i:{},this.body=null!=r?r:""}return r(e,[{key:"toString",value:function(){var t,n,i,r,o;for(n in t=[this.command],(i=!1===this.headers["content-length"])&&delete this.headers["content-length"],o=this.headers)s.call(o,n)&&(r=o[n],t.push(n+":"+r));return this.body&&!i&&t.push("content-length:"+e.sizeOfUTF8(this.body)),t.push(u+this.body),t.join(u)}}],[{key:"sizeOfUTF8",value:function(e){return e?encodeURI(e).match(/%..|./g).length:0}},{key:"unmarshall",value:function(t){var n,i,r,o;return i=t.split(RegExp("\0\n*")),(o={frames:[],partial:""}).frames=function(){var t,r,o,s;for(s=[],t=0,r=(o=i.slice(0,-1)).length;t<r;t++)n=o[t],s.push(e.unmarshallSingle(n));return s}(),(r=i.slice(-1)[0])===u||-1!==r.search(RegExp("\0\n*$"))?o.frames.push(e.unmarshallSingle(r)):o.partial=r,o}},{key:"marshall",value:function(t,n,i){return new e(t,n,i).toString()+"\0"}},{key:"unmarshallSingle",value:function(t){var n,i,r,o,s,a,c,l,h,f,d,p,b,g,v,y,m;for(o=t.search(RegExp("\n\n")),r=(s=t.substring(0,o).split(u)).shift(),a={},p=function(e){return e.replace(/^\s+|\s+$/g,"")},b=0,v=(y=s.reverse()).length;b<v;b++)l=(f=y[b]).indexOf(":"),a[p(f.substring(0,l))]=p(f.substring(l+1));if(n="",d=o+2,a["content-length"])h=parseInt(a["content-length"]),n=(""+t).substring(d,d+h);else for(i=null,c=g=d,m=t.length;(d<=m?g<m:g>m)&&"\0"!==(i=t.charAt(c));c=d<=m?++g:--g)n+=i;return new e(r,a,n)}}]),e}(),c=function(){function e(t){n(this,e),this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}return r(e,[{key:"debug",value:function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0}},{key:"_transmit",value:function(e,t,n){var i;for(i=a.marshall(e,t,n),"function"==typeof this.debug&&this.debug(">>> "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+i.length)}}},{key:"_setupHeartbeat",value:function(t){var n,i,r,o,s,a,c;if((s=t.version)===l.VERSIONS.V1_1||s===l.VERSIONS.V1_2)return i=(a=function(){var e,n,i,r;for(r=[],e=0,n=(i=t["heart-beat"].split(",")).length;e<n;e++)o=i[e],r.push(parseInt(o));return r}())[0],n=a[1],0!==this.heartbeat.outgoing&&0!==n&&(r=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+r+"ms"),this.pinger=l.setInterval(r,(c=this,function(){return c.ws.send(u),"function"==typeof c.debug?c.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==i?(r=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+r+"ms"),this.ponger=l.setInterval(r,function(t){return function(){var n;if((n=e.now()-t.serverActivity)>2*r)return"function"==typeof t.debug&&t.debug("did not receive server activity for the last "+n+"ms"),t.ws.close()}}(this))):void 0}},{key:"_parseConnect",value:function(){var e,t,n,i;switch(i={},(e=1<=arguments.length?o.call(arguments,0):[]).length){case 2:i=e[0],t=e[1];break;case 3:e[1]instanceof Function?(i=e[0],t=e[1],n=e[2]):(i.login=e[0],i.passcode=e[1],t=e[2]);break;case 4:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3];break;default:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3],i.host=e[4]}return[i,t,n]}},{key:"connect",value:function(){var t,n,i,r,s;return t=1<=arguments.length?o.call(arguments,0):[],r=this._parseConnect.apply(this,t),i=r[0],this.connectCallback=r[1],n=r[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(s=this,function(t){var i,r,o,c,l,h,f,d,p,b,g,v,y;if(c="undefined"!=typeof ArrayBuffer&&t.data instanceof ArrayBuffer?(i=new Uint8Array(t.data),"function"==typeof s.debug&&s.debug("--- got data length: "+i.length),function(){var e,t,n;for(n=[],e=0,t=i.length;e<t;e++)r=i[e],n.push(String.fromCharCode(r));return n}().join("")):t.data,s.serverActivity=e.now(),c!==u){for("function"==typeof s.debug&&s.debug("<<< "+c),p=a.unmarshall(s.partialData+c),s.partialData=p.partial,y=[],b=0,g=(v=p.frames).length;b<g;b++)switch((l=v[b]).command){case"CONNECTED":"function"==typeof s.debug&&s.debug("connected to server "+l.headers.server),s.connected=!0,s._setupHeartbeat(l.headers),y.push("function"==typeof s.connectCallback?s.connectCallback(l):void 0);break;case"MESSAGE":d=l.headers.subscription,(f=s.subscriptions[d]||s.onreceive)?(o=s,h=l.headers["message-id"],l.ack=function(e){return null==e&&(e={}),o.ack(h,d,e)},l.nack=function(e){return null==e&&(e={}),o.nack(h,d,e)},y.push(f(l))):y.push("function"==typeof s.debug?s.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":y.push("function"==typeof s.onreceipt?s.onreceipt(l):void 0);break;case"ERROR":y.push("function"==typeof n?n(l):void 0);break;default:y.push("function"==typeof s.debug?s.debug("Unhandled frame: "+l):void 0)}return y}"function"==typeof s.debug&&s.debug("<<< PONG")}),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof n?n(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),i["accept-version"]=l.VERSIONS.supportedVersions(),i["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",i)}}(this)}},{key:"disconnect",value:function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0}},{key:"_cleanUp",value:function(){if(this.connected=!1,this.pinger&&l.clearInterval(this.pinger),this.ponger)return l.clearInterval(this.ponger)}},{key:"send",value:function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)}},{key:"subscribe",value:function(e,t,n){var i;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}}},{key:"unsubscribe",value:function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})}},{key:"begin",value:function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}}},{key:"commit",value:function(e){return this._transmit("COMMIT",{transaction:e})}},{key:"abort",value:function(e){return this._transmit("ABORT",{transaction:e})}},{key:"ack",value:function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)}},{key:"nack",value:function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)}}],[{key:"now",value:function(){return Date.now?Date.now():(new Date).valueOf}}]),e}(),l={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var n;return null==t&&(t=["v10.stomp","v11.stomp"]),n=new(l.WebSocketClass||WebSocket)(e,t),new c(n)},over:function(e){return new c(e)},Frame:a};const h=l;return t.default})()}));